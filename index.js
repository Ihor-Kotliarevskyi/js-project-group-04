import{i as m,A as Y,R as Z,a as p,S as ee,N as te,P as re}from"./assets/vendor-Br7U2jgC.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function a(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=a(n);fetch(n.href,s)}})();const r={categories:document.querySelector("#categories"),products:document.querySelector("#products"),modal:document.querySelector(".modal"),modalProduct:document.querySelector(".modal-product"),loadMoreBtn:document.querySelector(".load-more-btn"),colorBox:document.querySelector(".products-color-list"),loader:document.querySelector(".loader"),feedbackCardList:document.querySelector(".feedback-card-list"),feedbackNavPrev:document.querySelector(".feedback-nav-prev"),feedbackNavNext:document.querySelector(".feedback-nav-next"),feedbackPaginationDots:document.querySelector(".feedback-pagination-dots"),feedbackSwiper:document.querySelector(".feedback-swiper"),loader:document.querySelector(".backdrope-loader")};function A(){setTimeout(()=>{r.loadMoreBtn.classList.add("is-show")},500)}function v(){r.loadMoreBtn.classList.remove("is-show")}function oe(e){return e<1||e>5?e:e>=3.3&&e<=3.7?3.5:e>=3.8&&e<=4.2?4:Math.round(e*2)/2}m.settings({position:"topRight",displayMode:"replace"});function k(e){m.info({message:e})}function I(e){m.error({message:e})}function $(){r.loader.classList.remove("hidden")}function x(){r.loader.classList.add("hidden")}function ae(e){const a=[{_id:"all",name:"Всі товари"},...e].map(({_id:o,name:n})=>`<li
        class="category-item" id="${o}"
        style="
          background-image: image-set(
            url('./furniture-bg/${o}.png') 1x,
            url('./furniture-bg/${o}@2x.png') 2x
          );
        "
      ><button class="categories-btn" type="button">${n}</button></li>`).join("");r.categories.innerHTML=a}function E(e){const t=e.map(({_id:a,name:o,images:n,price:s,color:c})=>`<li class="product-item" data-id="${a}">
        <img
          class="products-image"
          src='${n[0]}'
          alt="${o}"
        />
        <div class="product-description-box">
          <h4 class="products-title">${o}</h4>
          <ul class="products-color-list">
            ${c.map(S=>`<li class="products-color-box" style="background-color: ${S}"></li>`).join("")}
          </ul>
          <p class="products-price">${s} грн</p>
        </div>
        <button class="products-details-btn" type="button">Детальніше</button>
      </li>`).join("");r.products.insertAdjacentHTML("beforeend",t)}function ne(){r.products.innerHTML=""}new Y(".accordion-container",{duration:300,showMultiple:!1,beforeOpen:e=>{const t=e.querySelector(".ac-icon");t&&(t.style.transform="rotate(180deg)")},beforeClose:e=>{const t=e.querySelector(".ac-icon");t&&(t.style.transform="rotate(0deg)")}});function se(e){const t=e.rate??0,a=oe(t);return`
    <li class="swiper-slide feedback-card-item">
      <div class="feedback-rating" data-score="${a}" aria-label="Рейтинг ${a} з 5"></div>
      <p class="feedback-text">${e.descr||""}</p>
      <p class="feedback-author">${e.name||""}</p>
    </li>
  `}function ie(e){if(!r.feedbackCardList)return;const t=e.map(o=>se(o)).join("");r.feedbackCardList.innerHTML=t,r.feedbackCardList.querySelectorAll(".feedback-rating").forEach(o=>{const n=Number(o.dataset.score)||0;o.innerHTML="",new Z(o,{readOnly:!0,starType:"i",number:5,score:n,half:!0,halfShow:!0,starOn:"feedback-star-on",starOff:"feedback-star-off",starHalf:"feedback-star-half",space:!1}).init()})}const ce="https://furniture-store-v2.b.goit.study/api",P={FURNITURES:"/furnitures",CATEGORIES:"/categories",FEEDBACKS:"/feedbacks"},de=1,L=8,le=1,G=10;p.defaults.baseURL=ce;async function B(e=de){const{data:t}=await p(`${P.FURNITURES}?page=${e}&limit=${L}`);return t}async function z(e,t){const{data:a}=await p(`${P.FURNITURES}?page=${t}&limit=${L}&category=${e}`);return a}async function ue(){return(await p.get(P.CATEGORIES)).data}async function fe(e={page:le,limit:G}){return(await p.get(P.FEEDBACKS,{params:e})).data}p.defaults.baseURL="https://furniture-store-v2.b.goit.study/api";const i=document.querySelector(".modal-window");let h=null,w=null;function me(e=0){const t=Math.floor(e),a=e%1>=.5?1:0;let o="";for(let n=0;n<t;n++)o+='<span class="star star-full">★</span>';a&&(o+='<span class="star star-half">★</span>');for(let n=t+a;n<5;n++)o+='<span class="star star-empty">★</span>';return o}function pe(e){const t="https://furniture-store-v2.b.goit.study";return(e||[]).map(a=>typeof a=="string"&&a.startsWith("http")?a:`${t}${a}`)}function be(){return{dialog:i.querySelector(".product-modalWindow"),mainImg:i.querySelector(".modal-image-0"),thumbsWrap:i.querySelector(".modal-bottom-row"),titleEl:i.querySelector(".product-modal-title"),catEl:i.querySelector(".modal-description"),priceEl:i.querySelector(".modal-price"),starsEl:i.querySelector(".modal-rating-stars"),colorsWrap:i.querySelector(".radio-group"),descEl:i.querySelector(".furnitureDescription"),sizeEl:i.querySelector(".furnitureSize"),btnClose:i.querySelector(".modal-close-btn"),orderBtn:i.querySelector(".modalButton")}}async function ge(e){try{document.body.classList.add("modal-open"),i.classList.remove("visuallyhidden");const{data:t}=await p.get(`/furnitures/${e}`),{dialog:a,mainImg:o,thumbsWrap:n,titleEl:s,catEl:c,priceEl:S,starsEl:T,colorsWrap:R,descEl:F,sizeEl:O,btnClose:D,orderBtn:U}=be(),H=pe(t.images||t.image||[]),j=H.length?H:["https://via.placeholder.com/640x360?text=No+Image"],Q=j[0],X=j.slice(1,3);if(o&&(o.src=Q,o.alt=t?.name||"photo"),n&&(n.innerHTML=X.map(d=>`<img class="modal-thumb" src="${d}" alt="${t?.name||"thumb"}">`).join(""),n.dataset.bound||(n.addEventListener("click",d=>{const l=d.target.closest(".modal-thumb");if(!l||!o)return;const C=o.src;o.src=l.src,l.src=C}),n.dataset.bound="1")),s&&(s.textContent=t?.name||""),c&&(c.textContent=t?.category?.name||"Без категорії"),S&&(S.textContent=`${t?.price??0} грн`),T&&(T.innerHTML=me(t?.rate||0)),R){const d=Array.isArray(t?.color)?t.color:[];R.innerHTML=d.map((l,C)=>`<label><input type="radio" name="color" value="${l}" ${C===0?"checked":""}><span class="color-circle" style="background:${l}"></span></label>`).join("")}F&&(F.textContent=t?.description||"Опис відсутній"),O&&(O.textContent=`Розміри: ${t?.sizes||"—"}`),D&&(D.onclick=y),w=d=>{d.target===i&&y()},i.addEventListener("mousedown",w),h=d=>{d.key==="Escape"&&y()},document.addEventListener("keydown",h),U&&(U.onclick=()=>{const d=i.querySelector('input[name="color"]:checked'),l=d?d.value:null;y(),document.dispatchEvent(new CustomEvent("openOrderModal",{detail:{id:e,color:l}}))}),a&&(a.setAttribute("tabindex","-1"),a.focus({preventScroll:!0}))}catch(t){console.error("❌ Помилка завантаження товару",t),y()}}function y(){i.classList.add("visuallyhidden"),document.body.classList.remove("modal-open"),h&&(document.removeEventListener("keydown",h),h=null),w&&(i.removeEventListener("mousedown",w),w=null)}const N=document.querySelector(".backdrop");document.querySelector(".order-modal");const ye=document.querySelector(".modal-close-btn");document.querySelector(".modal-submit-btn");const f=document.querySelector(".modal-order-form");let W=null,_=null;async function ve(e,t){W=e,_=t,N.classList.add("is-open"),document.body.classList.add("modal-open"),await new Promise(a=>setTimeout(a,300)),window.addEventListener("keydown",K)}async function q(){N.classList.remove("is-open"),document.body.classList.remove("modal-open"),await new Promise(e=>setTimeout(e,300)),window.removeEventListener("keydown",K)}ye.addEventListener("click",async()=>{q()});N.addEventListener("click",async e=>{e.target===N&&await q()});function K(e){(e.key==="Escape"||e.key==="Esc")&&q()}f.addEventListener("submit",async e=>{e.preventDefault();const t=f.elements["user-name"].value.trim(),a=f.elements.phone.value.trim();if(!t||!a){m.warning({title:"Упс!",message:"Будь ласка, заповніть всі обов'язкові поля!",position:"topRight"});return}const o=a.replace(/[^\d+]/g,"");if(!/^\+?\d{10,15}$/.test(o)){m.warning({title:"Упс!",message:"Будь ласка, введіть коректний номер телефону",position:"topRight"});return}const s={name:t,phone:o,comment,productId:W,marker:_};try{if(!(await fetch("https://furniture-store-v2.b.goit.study/api-docs/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw new Error("Не вдалось створити замовлення. Спробуйте ще раз");m.success({title:"Успішно!",message:"Ваше замовлення відправлено!",position:"topRight",timeout:3e3}),f.reset(),await q()}catch{m.error({title:"Помилка!",message:"Щось пішло не так. Спробуйте ще раз.",position:"topRight"})}});function ke(e){const t=e.target;localStorage.setItem(t.name,t.value)}f.querySelectorAll("input, textarea").forEach(e=>{e.addEventListener("input",ke)});f.querySelectorAll("input, textarea").forEach(e=>{const t=localStorage.getItem(e.name);t&&(e.value=t)});f.addEventListener("submit",()=>{f.querySelectorAll("input, textarea").forEach(e=>{localStorage.removeItem(e.name)})});document.querySelector(".open-modal-btn")?.addEventListener("click",async()=>{await ve()});let b=1,g="";async function he(){try{$();const e=await ue();ae(e),g="all",r.categories.children[0].classList.add("categories-item--active");const{furnitures:a}=await B();E(a),A()}catch(e){I(e)}finally{x()}}async function V(e){const t=e.target.closest(".category-item");if(!t)return;[...e.currentTarget.children].map(o=>{o.classList.remove("categories-item--active")}),ne(),t.classList.add("categories-item--active"),b=1,g=t.id,$();try{if(g==="all"){const{furnitures:o}=await B();E(o),A()}else{const{furnitures:o,totalItems:n}=await z(g,b);if(o.length)n<L&&(v(),k("End collections")),E(o);else{v(),k("Not found");return}}}catch(o){I(o)}finally{x()}}async function J(e){e.preventDefault(),b++,$();try{if(g==="all"){const{furnitures:t,totalItems:a}=await B(b);a<L*b?(v(),k("End collections")):A(),E(t)}else{const{furnitures:t,totalItems:a}=await z(g,b);if(t.length)a<L&&(v(),k("End collections")),E(t);else{v(),k("Not found");return}}}catch(t){I(t)}finally{x()}}const we=e=>{const t=e.target.closest(".products-details-btn");if(!t)return;const a=t.closest(".product-item");if(!a)return;let o=a.dataset.id;if(!o){const c=(a.querySelector('img[src*="/furniture/"]')?.getAttribute("src")||"").match(/\/([a-f0-9]{24})_/i);c&&(o=c[1])}if(!o){console.warn("Не знайдено id товару для модалки");return}e.preventDefault(),ge(o)};let u=null;function Ee(e=10){if(!(!r.feedbackSwiper||!r.feedbackCardList))return u&&(u.destroy(!0,!0),u=null),u=new ee(r.feedbackSwiper,{modules:[te,re],slidesPerView:1,slidesPerGroup:1,spaceBetween:24,loop:!1,grabCursor:!0,allowTouchMove:!0,touchRatio:1,simulateTouch:!0,watchSlidesProgress:!0,navigation:{nextEl:r.feedbackNavNext,prevEl:r.feedbackNavPrev},pagination:{el:r.feedbackPaginationDots,clickable:!0,bulletClass:"feedback-pagination-dot",bulletActiveClass:"active",type:"bullets",dynamicBullets:!1},breakpoints:{375:{slidesPerView:1,slidesPerGroup:1,spaceBetween:16},768:{slidesPerView:2,slidesPerGroup:1,spaceBetween:24},1200:{slidesPerView:3,slidesPerGroup:1,spaceBetween:24}},on:{init:function(){M()},slideChange:function(){M()},resize:function(){M()}}}),u}function M(){if(!u||!r.feedbackNavPrev||!r.feedbackNavNext)return;const e=u.isBeginning,t=u.isEnd;e?(r.feedbackNavPrev.setAttribute("disabled","true"),r.feedbackNavPrev.classList.add("disabled"),r.feedbackNavPrev.setAttribute("aria-disabled","true")):(r.feedbackNavPrev.removeAttribute("disabled"),r.feedbackNavPrev.classList.remove("disabled"),r.feedbackNavPrev.setAttribute("aria-disabled","false")),t?(r.feedbackNavNext.setAttribute("disabled","true"),r.feedbackNavNext.classList.add("disabled"),r.feedbackNavNext.setAttribute("aria-disabled","true")):(r.feedbackNavNext.removeAttribute("disabled"),r.feedbackNavNext.classList.remove("disabled"),r.feedbackNavNext.setAttribute("aria-disabled","false"))}async function Le(){try{const t=(await fe({limit:G})).feedbacks||[];if(t.length===0){console.warn("No feedbacks received from API");return}ie(t),setTimeout(()=>{Ee(t.length)},50)}catch(e){console.error("Error loading feedbacks:",e)}}async function Se(){if(!r.feedbackSwiper||!r.feedbackCardList||!r.feedbackNavPrev||!r.feedbackNavNext||!r.feedbackPaginationDots){console.warn("Feedback section elements not found in DOM");return}await Le()}window.addEventListener("load",()=>{requestAnimationFrame(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})})});document.addEventListener("DOMContentLoaded",he);document.addEventListener("DOMContentLoaded",Se);r.categories.addEventListener("click",V);r.loadMoreBtn.addEventListener("click",J);document.addEventListener("DOMContentLoaded",()=>{r.categories&&!r.categories.dataset.bound&&(r.categories.addEventListener("click",V),r.categories.dataset.bound="1"),r.loadMoreBtn&&!r.loadMoreBtn.dataset.bound&&(r.loadMoreBtn.addEventListener("click",J),r.loadMoreBtn.dataset.bound="1");const e=r.products||document.getElementById("products");e&&e.dataset.boundModal!=="1"&&(e.addEventListener("click",we),e.dataset.boundModal="1")});
//# sourceMappingURL=index.js.map
