import{i as u,A as ee,R as te,a as b,S as re,N as ae,P as oe}from"./assets/vendor-D4I_HRR3.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const r={categories:document.querySelector("#categories"),products:document.querySelector("#products"),modal:document.querySelector(".modal"),modalProduct:document.querySelector(".modal-product"),loadMoreBtn:document.querySelector(".load-more-btn"),colorBox:document.querySelector(".products-color-list"),loader:document.querySelector(".loader"),feedbackCardList:document.querySelector(".feedback-card-list"),feedbackNavPrev:document.querySelector(".feedback-nav-prev"),feedbackNavNext:document.querySelector(".feedback-nav-next"),feedbackPaginationDots:document.querySelector(".feedback-pagination-dots"),feedbackSwiper:document.querySelector(".feedback-swiper"),loader:document.querySelector(".backdrope-loader")};function T(){setTimeout(()=>{r.loadMoreBtn.classList.add("is-show")},500)}function w(){r.loadMoreBtn.classList.remove("is-show")}function ne(e){return e<1||e>5?e:e>=3.3&&e<=3.7?3.5:e>=3.8&&e<=4.2?4:Math.round(e*2)/2}u.settings({position:"topRight",displayMode:"replace"});function L(e){u.info({message:e})}function F(e){u.error({message:e})}function P(){r.loader.classList.remove("hidden")}function A(){r.loader.classList.add("hidden")}function se(e){const n=[{_id:"all",name:"Всі товари"},...e].map(({_id:a,name:o})=>`<li
        class="category-item" id="${a}"
        style="
          background-image: image-set(
            url('./furniture-bg/${a}.png') 1x,
            url('./furniture-bg/${a}@2x.png') 2x
          );
        "
      ><button class="categories-btn" type="button">${o}</button></li>`).join("");r.categories.innerHTML=n}function M(e){const t=e.map(({_id:n,name:a,images:o,price:s,color:i})=>`<li class="product-item" data-id="${n}">
        <img
          class="products-image"
          src='${o[0]}'
          alt="${a}"
        />
        <div class="product-description-box">
          <h4 class="products-title">${a}</h4>
          <ul class="products-color-list">
            ${i.map(g=>`<li class="products-color-box" style="background-color: ${g}"></li>`).join("")}
          </ul>
          <p class="products-price">${s} грн</p>
        </div>
        <button class="products-details-btn" type="button">Детальніше</button>
      </li>`).join("");r.products.insertAdjacentHTML("beforeend",t)}function ie(){r.products.innerHTML=""}new ee(".accordion-container",{duration:300,showMultiple:!1,beforeOpen:e=>{const t=e.querySelector(".ac-icon");t&&(t.style.transform="rotate(180deg)")},beforeClose:e=>{const t=e.querySelector(".ac-icon");t&&(t.style.transform="rotate(0deg)")}});function ce(e){const t=e.rate??0,n=ne(t);return`
    <li class="swiper-slide feedback-card-item">
      <div class="feedback-rating" data-score="${n}" aria-label="Рейтинг ${n} з 5"></div>
      <p class="feedback-text">${e.descr||""}</p>
      <p class="feedback-author">${e.name||""}</p>
    </li>
  `}function de(e){if(!r.feedbackCardList)return;const t=e.map(a=>ce(a)).join("");r.feedbackCardList.innerHTML=t,r.feedbackCardList.querySelectorAll(".feedback-rating").forEach(a=>{const o=Number(a.dataset.score)||0;a.innerHTML="",new te(a,{readOnly:!0,starType:"i",number:5,score:o,half:!0,halfShow:!0,starOn:"feedback-star-on",starOff:"feedback-star-off",starHalf:"feedback-star-half",space:!1}).init()})}const le="https://furniture-store-v2.b.goit.study/api",I={FURNITURES:"/furnitures",CATEGORIES:"/categories",FEEDBACKS:"/feedbacks"},ue=1,C=8,fe=1,K=10;b.defaults.baseURL=le;async function O(e=ue){const{data:t}=await b(`${I.FURNITURES}?page=${e}&limit=${C}`);return t}async function V(e,t){const{data:n}=await b(`${I.FURNITURES}?page=${t}&limit=${C}&category=${e}`);return n}async function me(){return(await b.get(I.CATEGORIES)).data}async function pe(e={page:fe,limit:K}){return(await b.get(I.FEEDBACKS,{params:e})).data}b.defaults.baseURL="https://furniture-store-v2.b.goit.study/api";const l=document.querySelector(".modal-window");let S=null,N=null;function be(e=0){const t=Math.floor(e),n=e%1>=.5?1:0;let a="";for(let o=0;o<t;o++)a+='<span class="star star-full">★</span>';n&&(a+='<span class="star star-half">★</span>');for(let o=t+n;o<5;o++)a+='<span class="star star-empty">★</span>';return a}function ge(e){const t="https://furniture-store-v2.b.goit.study";return(e||[]).map(n=>typeof n=="string"&&n.startsWith("http")?n:`${t}${n}`)}function d(e,t){return e.querySelector(t)}function ye(e){return{dialog:d(e,".product-modalWindow"),mainImg:d(e,".modal-image-0"),thumbsWrap:d(e,".modal-bottom-row"),titleEl:d(e,".product-modal-title"),catEl:d(e,".modal-description"),priceEl:d(e,".modal-price"),starsEl:d(e,".modal-rating-stars"),colorsWrap:d(e,".radio-group"),descEl:d(e,".furnitureDescription"),sizeEl:d(e,".furnitureSize"),btnClose:d(e,".modal-close-btn"),orderBtn:d(e,".modalButton")}}async function ve(e){P();try{document.body.classList.add("modal-open"),l.classList.remove("visuallyhidden"),l.removeAttribute("aria-hidden");const{data:t}=await b.get(`/furnitures/${e}`),{dialog:n,mainImg:a,thumbsWrap:o,titleEl:s,catEl:i,priceEl:g,starsEl:v,colorsWrap:D,descEl:U,sizeEl:H,btnClose:G,orderBtn:j}=ye(l),z=ge(t.images||t.image||[]),W=z.length?z:["https://via.placeholder.com/640x360?text=No+Image"],Y=W[0],Z=W.slice(1,3);if(a&&(a.src=Y,a.alt=t?.name||"photo"),o&&(o.innerHTML=Z.map(c=>`<img class="modal-thumb" src="${c}" alt="${t?.name||"thumb"}">`).join(""),o.dataset.bound||(o.addEventListener("click",c=>{const f=c.target.closest(".modal-thumb");if(!f||!a)return;const $=a.src;a.src=f.src,f.src=$}),o.dataset.bound="1")),s&&(s.textContent=t?.name||""),i&&(i.textContent=t?.category?.name||"Без категорії"),g&&(g.textContent=`${t?.price??0} грн`),v&&(v.innerHTML=be(t?.rate||0)),U&&(U.textContent=t?.description||"Опис відсутній"),H&&(H.textContent=`Розміри: ${t?.sizes||"—"}`),D){const c=Array.isArray(t?.color)?t.color:[];D.innerHTML=c.map((f,$)=>`<label><input type="radio" name="color" value="${f}" ${$===0?"checked":""}><span class="color-circle" style="background:${f}"></span></label>`).join("")}G&&(G.onclick=E),N=c=>{c.target===l&&E()},l.addEventListener("mousedown",N),S=c=>{c.key==="Escape"&&E()},document.addEventListener("keydown",S),j&&(j.onclick=()=>{const c=l.querySelector('input[name="color"]:checked'),f=c?c.value:null;we(e,f),E()}),n&&(n.setAttribute("tabindex","-1"),n.focus({preventScroll:!0}))}catch(t){E(),showError(t),closeModal()}finally{A()}}function E(){const e=document.activeElement;e&&l.contains(e)&&e.blur(),l.classList.add("visuallyhidden"),l.setAttribute("aria-hidden","true"),document.body.classList.remove("modal-open"),S&&(document.removeEventListener("keydown",S),S=null),N&&(l.removeEventListener("mousedown",N),N=null)}const y=document.querySelector(".backdrop");document.querySelector(".order-modal");const he=document.querySelector(".modal-close-btn"),_=document.querySelector(".modal-submit-btn"),m=document.querySelector(".modal-order-form");let x=null,R=null;function ke(){document.body.classList.add("modal-open")}function Ee(){document.body.classList.remove("modal-open")}function J(e){e.key==="Escape"&&B()}async function we(e,t){x=e??null,R=t??null,y.classList.add("is-open"),y.removeAttribute("aria-hidden"),ke(),setTimeout(()=>{m?.elements["user-name"]?.focus()},10),window.addEventListener("keydown",J)}async function B(){const e=document.activeElement;e&&y.contains(e)&&e.blur(),y.classList.remove("is-open"),y.setAttribute("aria-hidden","true"),Ee(),window.removeEventListener("keydown",J)}he?.addEventListener("click",()=>B());y?.addEventListener("mousedown",e=>{e.target===y&&B()});m?.addEventListener("submit",async e=>{e.preventDefault();const t=m.elements["user-name"]?.value.trim()||"",n=m.elements.phone?.value.trim()||"",a=m.elements["user-comment"]?.value.trim()||"";if(!t||!n){u.warning({title:"Увага",message:"Будь ласка, заповніть ім'я та телефон.",position:"topRight"});return}if(!x){u.warning({title:"Увага",message:"Оберіть товар (відкрийте картку і натисніть “Перейти до замовлення”).",position:"topRight"});return}if(!R){u.warning({title:"Увага",message:"Оберіть колір у картці товару перед замовленням.",position:"topRight"});return}const o=n.replace(/[^\d+]/g,"");if(!/^\+?\d{10,15}$/.test(o)){u.warning({title:"Увага",message:"Введіть коректний номер телефону.",position:"topRight"});return}const i={name:t,phone:o,comment:a,modelId:x,color:R};_.disabled=!0;try{const g=await b.post("/orders",i);u.success({title:"Успішно",message:"Ваше замовлення відправлено!",position:"topRight",timeout:3e3}),m.reset(),m.querySelectorAll("input, textarea").forEach(v=>{localStorage.removeItem(v.name)}),B()}catch(g){const v=g?.response?.data?.message||"Щось пішло не так. Спробуйте ще раз.";u.error({title:"Помилка",message:v,position:"topRight"})}finally{_.disabled=!1}});function Le(e){const t=e.target;t?.name&&localStorage.setItem(t.name,t.value)}m?.querySelectorAll("input, textarea").forEach(e=>{e.addEventListener("input",Le);const t=localStorage.getItem(e.name);t&&(e.value=t)});let h=1,k="";async function Se(){try{P();const e=await me();se(e),k="all",r.categories.children[0].classList.add("categories-item--active");const{furnitures:n}=await O();M(n),T()}catch(e){F(e)}finally{A()}}async function Q(e){const t=e.target.closest(".category-item");if(!t)return;[...e.currentTarget.children].map(a=>{a.classList.remove("categories-item--active")}),ie(),t.classList.add("categories-item--active"),h=1,k=t.id,P();try{if(k==="all"){const{furnitures:a}=await O();M(a),T()}else{const{furnitures:a,totalItems:o}=await V(k,h);if(a.length)o<C&&(w(),L("End collections")),M(a);else{w(),L("Not found");return}}}catch(a){F(a)}finally{A()}}async function X(e){e.preventDefault(),h++,P();try{if(k==="all"){const{furnitures:t,totalItems:n}=await O(h);n<C*h?(w(),L("End collections")):T(),M(t)}else{const{furnitures:t,totalItems:n}=await V(k,h);if(t.length)n<C&&(w(),L("End collections")),M(t);else{w(),L("Not found");return}}}catch(t){F(t)}finally{A()}}const Ne=e=>{const t=e.target.closest(".products-details-btn");if(!t)return;const n=t.closest(".product-item");if(!n)return;let a=n.dataset.id;if(!a){const i=(n.querySelector('img[src*="/furniture/"]')?.getAttribute("src")||"").match(/\/([a-f0-9]{24})_/i);i&&(a=i[1])}if(!a){console.warn("Не знайдено id товару для модалки");return}e.preventDefault(),ve(a)};let p=null;function Me(e=10){if(!(!r.feedbackSwiper||!r.feedbackCardList))return p&&(p.destroy(!0,!0),p=null),p=new re(r.feedbackSwiper,{modules:[ae,oe],slidesPerView:1,slidesPerGroup:1,spaceBetween:24,loop:!1,grabCursor:!0,allowTouchMove:!0,touchRatio:1,simulateTouch:!0,watchSlidesProgress:!0,navigation:{nextEl:r.feedbackNavNext,prevEl:r.feedbackNavPrev},pagination:{el:r.feedbackPaginationDots,clickable:!0,bulletClass:"feedback-pagination-dot",bulletActiveClass:"active",type:"bullets",dynamicBullets:!1},breakpoints:{375:{slidesPerView:1,slidesPerGroup:1,spaceBetween:16},768:{slidesPerView:2,slidesPerGroup:1,spaceBetween:24},1200:{slidesPerView:3,slidesPerGroup:1,spaceBetween:24}},on:{init:function(){q()},slideChange:function(){q()},resize:function(){q()}}}),p}function q(){if(!p||!r.feedbackNavPrev||!r.feedbackNavNext)return;const e=p.isBeginning,t=p.isEnd;e?(r.feedbackNavPrev.setAttribute("disabled","true"),r.feedbackNavPrev.classList.add("disabled"),r.feedbackNavPrev.setAttribute("aria-disabled","true")):(r.feedbackNavPrev.removeAttribute("disabled"),r.feedbackNavPrev.classList.remove("disabled"),r.feedbackNavPrev.setAttribute("aria-disabled","false")),t?(r.feedbackNavNext.setAttribute("disabled","true"),r.feedbackNavNext.classList.add("disabled"),r.feedbackNavNext.setAttribute("aria-disabled","true")):(r.feedbackNavNext.removeAttribute("disabled"),r.feedbackNavNext.classList.remove("disabled"),r.feedbackNavNext.setAttribute("aria-disabled","false"))}async function Ce(){try{const t=(await pe({limit:K})).feedbacks||[];if(t.length===0){console.warn("No feedbacks received from API");return}de(t),setTimeout(()=>{Me(t.length)},50)}catch(e){console.error("Error loading feedbacks:",e)}}async function Pe(){if(!r.feedbackSwiper||!r.feedbackCardList||!r.feedbackNavPrev||!r.feedbackNavNext||!r.feedbackPaginationDots){console.warn("Feedback section elements not found in DOM");return}await Ce()}window.addEventListener("load",()=>{requestAnimationFrame(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})})});document.addEventListener("DOMContentLoaded",Se);document.addEventListener("DOMContentLoaded",Pe);r.categories.addEventListener("click",Q);r.loadMoreBtn.addEventListener("click",X);document.addEventListener("DOMContentLoaded",()=>{r.categories&&!r.categories.dataset.bound&&(r.categories.addEventListener("click",Q),r.categories.dataset.bound="1"),r.loadMoreBtn&&!r.loadMoreBtn.dataset.bound&&(r.loadMoreBtn.addEventListener("click",X),r.loadMoreBtn.dataset.bound="1");const e=r.products||document.getElementById("products");e&&e.dataset.boundModal!=="1"&&(e.addEventListener("click",Ne),e.dataset.boundModal="1")});
//# sourceMappingURL=index.js.map
