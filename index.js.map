{"version":3,"file":"index.js","sources":["../src/js/modal.js","../src/js/constants.js","../src/js/products-api.js","../src/js/handlers.js","../src/js/render-function.js","../src/main.js"],"sourcesContent":["\nimport axios from 'axios';\n\naxios.defaults.baseURL = 'https://furniture-store-v2.b.goit.study/api';\nconst modalWindow = document.querySelector('.modal-window');\n\nlet escHandler = null;\nlet backdropHandler = null;\n\n// ===== зірки =====\nfunction stars(rate = 0) {\n  const full = Math.floor(rate);\n  const half = rate % 1 >= 0.5 ? 1 : 0;\n  let out = '';\n  for (let i = 0; i < full; i++) out += '<span class=\"star star-full\">★</span>';\n  if (half) out += '<span class=\"star star-half\">★</span>';\n  for (let i = full + half; i < 5; i++) out += '<span class=\"star star-empty\">★</span>';\n  return out;\n}\nfunction normalizeImages(list) {\n  const BASE = 'https://furniture-store-v2.b.goit.study';\n  return (list || []).map(src => (typeof src === 'string' && src.startsWith('http') ? src : `${BASE}${src}`));\n}\n\n\nfunction getRefs() {\n  return {\n    dialog: modalWindow.querySelector('.product-modalWindow'),\n    mainImg: modalWindow.querySelector('.modal-image-0'),\n    thumbsWrap: modalWindow.querySelector('.modal-bottom-row'),\n    titleEl: modalWindow.querySelector('.product-modal-title'),\n    catEl: modalWindow.querySelector('.modal-description'),\n    priceEl: modalWindow.querySelector('.modal-price'),\n    starsEl: modalWindow.querySelector('.modal-rating-stars'),\n    colorsWrap: modalWindow.querySelector('.radio-group'),\n    descEl: modalWindow.querySelector('.furnitureDescription'),\n    sizeEl: modalWindow.querySelector('.furnitureSize'),\n    btnClose: modalWindow.querySelector('.modal-close-btn'),\n    orderBtn: modalWindow.querySelector('.modalButton'),\n  };\n}\n\n\nexport async function openProductModal(id) {\n  try {\n    // відкрити модалку\n    document.body.classList.add('modal-open');\n    modalWindow.classList.remove('visuallyhidden');\n\n    const { data } = await axios.get(`/furnitures/${id}`);\n\n    const {\n      dialog,\n      mainImg,\n      thumbsWrap,\n      titleEl,\n      catEl,\n      priceEl,\n      starsEl,\n      colorsWrap,\n      descEl,\n      sizeEl,\n      btnClose,\n      orderBtn,\n    } = getRefs();\n\n    // — гарантуємо картинки —\n    const imgs = normalizeImages(data.images || data.image || []);\n    const safeImgs = imgs.length ? imgs : ['https://via.placeholder.com/640x360?text=No+Image'];\n    const main = safeImgs[0];\n    const thumbs = safeImgs.slice(1, 3);\n\n    // ліва колонка\n    if (mainImg) {\n      mainImg.src = main;\n      mainImg.alt = data?.name || 'photo';\n    }\n    if (thumbsWrap) {\n      thumbsWrap.innerHTML = thumbs\n        .map(src => `<img class=\"modal-thumb\" src=\"${src}\" alt=\"${data?.name || 'thumb'}\">`)\n        .join('');\n\n      // делегування кліку по прев’ю \n      if (!thumbsWrap.dataset.bound) {\n        thumbsWrap.addEventListener('click', e => {\n          const img = e.target.closest('.modal-thumb');\n          if (!img || !mainImg) return;\n          const tmp = mainImg.src;\n          mainImg.src = img.src;\n          img.src = tmp;\n        });\n        thumbsWrap.dataset.bound = '1';\n      }\n    }\n\n    // права колонка\n    if (titleEl) titleEl.textContent = data?.name || '';\n    if (catEl) catEl.textContent = data?.category?.name || 'Без категорії';\n    if (priceEl) priceEl.textContent = `${data?.price ?? 0} грн`;\n    if (starsEl) starsEl.innerHTML = stars(data?.rate || 0);\n\n    if (colorsWrap) {\n      const colors = Array.isArray(data?.color) ? data.color : [];\n      colorsWrap.innerHTML = colors\n        .map(\n          (c, i) =>\n            `<label><input type=\"radio\" name=\"color\" value=\"${c}\" ${i === 0 ? 'checked' : ''}><span class=\"color-circle\" style=\"background:${c}\"></span></label>`\n        )\n        .join('');\n    }\n\n    if (descEl) descEl.textContent = data?.description || 'Опис відсутній';\n    if (sizeEl) sizeEl.textContent = `Розміри: ${data?.sizes || '—'}`;\n\n    // закриття: бекдроп + ✕ + Esc\n    if (btnClose) btnClose.onclick = closeModal;\n\n    backdropHandler = e => {\n      if (e.target === modalWindow) closeModal(); // тільки прямий клік по бекдропу\n    };\n    modalWindow.addEventListener('mousedown', backdropHandler);\n\n    escHandler = e => {\n      if (e.key === 'Escape') closeModal();\n    };\n    document.addEventListener('keydown', escHandler);\n\n    // кнопка замовлення (якщо треба — кинемо подію, аби інший модуль відкрив форму)\n    if (orderBtn) {\n      orderBtn.onclick = () => {\n        const checked = modalWindow.querySelector('input[name=\"color\"]:checked');\n        const color = checked ? checked.value : null;\n        closeModal();\n        document.dispatchEvent(\n          new CustomEvent('openOrderModal', {\n            detail: { id, color },\n          })\n        );\n      };\n    }\n\n\n    if (dialog) {\n      dialog.setAttribute('tabindex', '-1');\n      dialog.focus({ preventScroll: true });\n    }\n  } catch (e) {\n    console.error('❌ Помилка завантаження товару', e);\n    closeModal();\n  }\n}\n\n// ===== приватні\nfunction closeModal() {\n  modalWindow.classList.add('visuallyhidden');\n  document.body.classList.remove('modal-open');\n\n  if (escHandler) {\n    document.removeEventListener('keydown', escHandler);\n    escHandler = null;\n  }\n  if (backdropHandler) {\n    modalWindow.removeEventListener('mousedown', backdropHandler);\n    backdropHandler = null;\n  }\n}\n\n\n/* ===== тестовий виклик (можна прибрати) =====\n*/\n// openProductModal('682f9bbf8acbdf505592ac45');\nimport iziToast from \"izitoast\";\n\n// order-modal\n\n\n\nconst backdropOrderModal = document.querySelector('.backdrop');\nconst modalOrder = document.querySelector('.order-modal');\nconst closeOrderBtn = document.querySelector('.modal-close-btn');\nconst submitBtn = document.querySelector('.modal-submit-btn');\nconst orderForm = document.querySelector('.modal-order-form');\n\nfunction openOrderModal() {\n    backdropOrderModal.classList.add('is-open');\n    document.body.classList.add('modal-open');\n\n    window.addEventListener('keydown', handleEscape);\n}\n\nfunction closeOrderModal() {\n    backdropOrderModal.classList.remove('is-open');\n    document.body.classList.remove('modal-open');\n\n    window.removeEventListener('keydown', handleEscape);\n}\n\ncloseOrderBtn.addEventListener('click', closeOrderModal);\n\nbackdropOrderModal.addEventListener('click', (event) => {\n    if (event.target === backdropOrderModal) {\n        closeOrderModal();\n    }\n});\n\nfunction handleEscape(event) {\n    if (event.key === 'Escape' || event.key === 'Esc') {\n        closeOrderModal();\n    }\n}\n\norderForm.addEventListener('submit', (event) => {\n    event.preventDefault();\n\n    const name = orderForm.elements['user-name'].value.trim();\n    const phone = orderForm.elements['phone'].value.trim();\n    const comment = orderForm.elements['user-comment'].value.trim();\n\n    if (!name || !phone) {\n        iziToast.warning({\n            title: \"Ooops!\",\n            message: \"Будь ласка, заповніть всі обов'язкові поля!\",\n            position: \"topRight\",\n        });\n        return;\n    }\n\n    const clearPhone = phone.replace(/[^\\d+]/g, '');\n    const phonePattern = /^\\+?\\d{10,15}$/;\n\n    if (!phonePattern.test(clearPhone)) {\n        iziToast.warning({\n            title: \"Ooops!\",\n            message: \"Будь ласка, введіть коректний номер телефону\",\n            position: \"topRight\",\n        });\n        return;\n    }\n    \n})\n\n// тестова кнопка для відкриття модалки\ndocument.querySelector('.open-modal-btn')?.addEventListener('click', openOrderModal);\n","//API ендпоінти:\n\nexport const BASE_URL = 'https://furniture-store-v2.b.goit.study/api';\nexport const API_ENDPOINTS = {\n  FURNITURES: '/furnitures/',\n  CATEGORIES: '/categories',\n  FEEDBACKS: '/feedbacks',\n  ORDERS: '/orders',\n};\nexport const FURNITURE_PAGE = 1;\nexport const FURNITURE_LIMIT = 8;\n\nexport const FEEDBACK_PAGE = 1;\nexport const FEEDBACK_LIMIT = 10;\n\nexport const getFurnitureByIdEndpoint = id => `/furnitures/${id}`;\n","// Функції для запитів на бекенд.\nimport axios from 'axios';\nimport {\n  BASE_URL,\n  API_ENDPOINTS,\n  getFurnitureByIdEndpoint,\n  FURNITURE_PAGE,\n  FURNITURE_LIMIT,\n  FEEDBACK_PAGE,\n  FEEDBACK_LIMIT,\n} from './constants.js';\naxios.defaults.baseURL = BASE_URL;\n// Functions for Furnitures\nexport async function getFurnitures(\n  params = { page: FURNITURE_PAGE, limit: FURNITURE_LIMIT }\n) {\n  const response = await axios.get(API_ENDPOINTS.FURNITURES, { params });\n  const furnituresData = response.data;\n  return furnituresData;\n}\n// Furniture by Id\nexport async function getFurnitureByID(id) {\n  const endpoint = getFurnitureByIdEndpoint(id);\n  const response = await axios.get(endpoint);\n  const furnitureItem = response.data;\n  return furnitureItem; // один обєкт меблів\n}\n// Functions for Categories\nexport async function getCategories() {\n  const response = await axios.get(API_ENDPOINTS.CATEGORIES);\n  const categoriesData = response.data;\n\n  return categoriesData; // масив категорій\n}\n// Feedbacks\nexport async function getFeedbacks(\n  params = { page: FEEDBACK_PAGE, limit: FURNITURE_LIMIT }\n) {\n  const response = await axios.get(API_ENDPOINTS.FEEDBACKS, { params });\n  const feedbackData = response.data;\n  return feedbackData;\n}\n// Orders\nexport async function createOrder(orderData) {\n  const response = await axios.post(API_ENDPOINTS.ORDERS, orderData);\n  const createOrder = response.data;\n  return createOrder;\n}\n","// Хендлери, які передаються в addEventListener.\n\nimport {\n  getFurnitures,\n  getFurnitureByID,\n  getCategories,\n  getFeedbacks,\n  createOrder,\n} from './products-api.js';\n\nimport {\n  FURNITURE_PAGE,\n  FURNITURE_LIMIT,\n  FEEDBACK_PAGE,\n  FEEDBACK_LIMIT,\n} from './constants.js';\n// furniture\nexport async function loadFurnitures(\n  params = { page: FURNITURE_PAGE, limit: FURNITURE_LIMIT }\n) {\n  try {\n    const data = await getFurnitures(params);\n    console.log('Furnitures:', data);\n    return data;\n  } catch (error) {\n    console.error('Furnitures downloading error:', error);\n    return null;\n  }\n}\nexport async function loadFurnitureById(id) {\n  try {\n    const data = await loadFurnitureById(id);\n    console.log('Furniture details:', data);\n    return data;\n  } catch (error) {\n    console.error('Furniture id downloading error:', error);\n    return null;\n  }\n}\nexport async function loadCategories() {\n  try {\n    const data = await loadCategories();\n    console.log('Categories:', data);\n    return data;\n  } catch (error) {\n    console.error('Categories downloading error:', error);\n    return null;\n  }\n}\nexport async function loadFeedbacks(\n  params = { page: FEEDBACK_PAGE, limit: FEEDBACK_LIMIT }\n) {\n  try {\n    const data = await loadFeedbacks(params);\n    console.log('Feedbacks', data);\n    return data;\n  } catch (error) {\n    console.error('Feedbacks downloading error:', error);\n    return null;\n  }\n}\nexport async function sendOrder() {\n  try {\n    const data = await sendOrder();\n    console.log('Order created:', data);\n    return data;\n  } catch (error) {\n    console.error('Creating order error:', error);\n    return null;\n  }\n}\n","// Функції для відображення елементів інтерфейсу.\n\nimport Accordion from \"accordion-js\";\nimport \"accordion-js/dist/accordion.min.css\";\n\n\nnew Accordion('.accordion-container', {\n  duration: 300,\n  showMultiple: false,\n});","import './css/furniture_details_modal.css';\nimport './js/modal.js';\n// Логіка сторінки index.html\nimport { FURNITURE_LIMIT, FURNITURE_PAGE } from './js/constants.js';\nimport { loadFurnitures } from './js/handlers.js';\n\ndocument.addEventListener('DOMContentLoaded', async () => {\n  console.log('Перевірка API...');\n  // testing furnitures\n  const furnitures = await loadFurnitures({\n    page: FURNITURE_PAGE,\n    limit: FURNITURE_LIMIT,\n  });\n  console.log('Меблі:', furnitures);\n});\n\nimport './js/render-function.js';\n\nimport './js/modal.js';\n"],"names":["axios","backdropOrderModal","closeOrderBtn","orderForm","openOrderModal","handleEscape","closeOrderModal","event","name","phone","iziToast","clearPhone","BASE_URL","API_ENDPOINTS","FURNITURE_PAGE","FURNITURE_LIMIT","getFurnitures","params","loadFurnitures","data","error","Accordion","furnitures"],"mappings":"owBAGAA,EAAM,SAAS,QAAU,8CACL,SAAS,cAAc,eAAe,EA6K1D,MAAMC,EAAqB,SAAS,cAAc,WAAW,EAC1C,SAAS,cAAc,cAAc,EACxD,MAAMC,EAAgB,SAAS,cAAc,kBAAkB,EAC7C,SAAS,cAAc,mBAAmB,EAC5D,MAAMC,EAAY,SAAS,cAAc,mBAAmB,EAE5D,SAASC,GAAiB,CACtBH,EAAmB,UAAU,IAAI,SAAS,EAC1C,SAAS,KAAK,UAAU,IAAI,YAAY,EAExC,OAAO,iBAAiB,UAAWI,CAAY,CACnD,CAEA,SAASC,GAAkB,CACvBL,EAAmB,UAAU,OAAO,SAAS,EAC7C,SAAS,KAAK,UAAU,OAAO,YAAY,EAE3C,OAAO,oBAAoB,UAAWI,CAAY,CACtD,CAEAH,EAAc,iBAAiB,QAASI,CAAe,EAEvDL,EAAmB,iBAAiB,QAAUM,GAAU,CAChDA,EAAM,SAAWN,GACjBK,EAAe,CAEvB,CAAC,EAED,SAASD,EAAaE,EAAO,EACrBA,EAAM,MAAQ,UAAYA,EAAM,MAAQ,QACxCD,EAAe,CAEvB,CAEAH,EAAU,iBAAiB,SAAWI,GAAU,CAC5CA,EAAM,eAAc,EAEpB,MAAMC,EAAOL,EAAU,SAAS,WAAW,EAAE,MAAM,KAAI,EACjDM,EAAQN,EAAU,SAAS,MAAS,MAAM,KAAI,EAGpD,GAFgBA,EAAU,SAAS,cAAc,EAAE,MAAM,KAAI,EAEzD,CAACK,GAAQ,CAACC,EAAO,CACjBC,EAAS,QAAQ,CACb,MAAO,SACP,QAAS,8CACT,SAAU,UACtB,CAAS,EACD,MACJ,CAEA,MAAMC,EAAaF,EAAM,QAAQ,UAAW,EAAE,EAG9C,GAAI,CAFiB,iBAEH,KAAKE,CAAU,EAAG,CAChCD,EAAS,QAAQ,CACb,MAAO,SACP,QAAS,+CACT,SAAU,UACtB,CAAS,EACD,MACJ,CAEJ,CAAC,EAGD,SAAS,cAAc,iBAAiB,GAAG,iBAAiB,QAASN,CAAc,EChP5E,MAAMQ,EAAW,8CACXC,EAAgB,CAC3B,WAAY,cAId,EACaC,EAAiB,EACjBC,EAAkB,ECC/Bf,EAAM,SAAS,QAAUY,EAElB,eAAeI,EACpBC,EAAS,CAAE,KAAMH,EAAgB,MAAOC,CAAe,EACvD,CAGA,OAFiB,MAAMf,EAAM,IAAIa,EAAc,WAAY,CAAE,OAAAI,EAAQ,GACrC,IAElC,CCFO,eAAeC,EACpBD,EAAS,CAAE,KAAMH,EAAgB,MAAOC,CAAe,EACvD,CACA,GAAI,CACF,MAAMI,EAAO,MAAMH,EAAcC,CAAM,EACvC,eAAQ,IAAI,cAAeE,CAAI,EACxBA,CACT,OAASC,EAAO,CACd,eAAQ,MAAM,gCAAiCA,CAAK,EAC7C,IACT,CACF,CCtBA,IAAIC,EAAU,uBAAwB,CACpC,SAAU,IACV,aAAc,EAChB,CAAC,ECHD,SAAS,iBAAiB,mBAAoB,SAAY,CACxD,QAAQ,IAAI,kBAAkB,EAE9B,MAAMC,EAAa,MAAMJ,EAAe,CACtC,KAAMJ,EACN,MAAOC,CACX,CAAG,EACD,QAAQ,IAAI,SAAUO,CAAU,CAClC,CAAC"}